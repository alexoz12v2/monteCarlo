\documentclass[14pt, aspectratio=169]{beamer}

% pseudocode first slide
\usepackage{algorithm}
\usepackage{algpseudocode}

\algnewcommand\algorithmicinput{\textbf{Input:}}
\algnewcommand\Inputt{\item[\algorithmicinput]}

\algnewcommand\algorithmicoutput{\textbf{Output:}}
\algnewcommand\Outputt{\item[\algorithmicoutput]}

% -------------------- beamer configuration
% theme
\usetheme{Copenhagen}
\usecolortheme{beaver}

% hide navigation symbols
\setbeamertemplate{navigation symbols}{}

% hide section summary header
\setbeamertemplate{headline}{}

\usepackage{xcolor}

% --------- math packages
% theorems
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{upgreek} % uptau
\usepackage{siunitx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{stackrel}
\usepackage{mathtools} % norm
\usepackage[inline]{enumitem}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{nameref}
\usepackage{cleveref}
\usepackage{graphicx}
\usepackage{svg}
\usepackage{calc}
\usepackage{mdframed}
\usepackage{environ} % to declare scaletikzpicturetowidth with NewEnviron

% ------------ font related packages
% stuff for utf16
\usepackage{unicode-math-luatex}
\usepackage{unicode-math}
\usepackage{fontspec}
\usepackage{lmodern} % more font sizes

\setmathfont[mathrm=sym]{Latin Modern Math}

% ------------------ page layout
%\usepackage{geometry}
%\geometry{
%	inner=37.125mm,
%	outer=33.4125mm,
%	top=37.125mm,
%	bottom=37.125mm,
%	heightrounded,
%	marginparwidth=51pt,
%	marginparsep=17pt,
%	headsep=24pt,
%}

% ------------- beautiful tables
\usepackage{booktabs}

% -------------- the bibliography
\usepackage[
	backend=biber,
	style=alphabetic,
	sorting=ynt
]{biblatex}

% ------------------- graphics
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{physics}
\usepackage{ifthen}
\usepackage{cutwin} % wrapfigures with beamer https://tex.stackexchange.com/questions/56205/wrapfigure-beamer-style

\usetikzlibrary{shadings}
\usetikzlibrary{calc}
\usetikzlibrary{arrows,arrows.meta} % Stealth arrows
\usetikzlibrary{angles,quotes} % for \draw pic (angle labels)
\usetikzlibrary{graphs,graphdrawing} % tree drawing for Owen Scrambling
\usegdlibrary{trees}
\tikzset{>=latex} % for LaTex arrow head

\newcommand{\professor}{Prof.ssa Marina Popolizio}
\makeatletter
\newsavebox{\measure@tikzpicture}
\NewEnviron{scaletikzpicturetowidth}[1]{%
	\def\tikz@width{#1}%
	\def\tikzscale{1}\begin{lrbox}{\measure@tikzpicture}%
	\BODY
	\end{lrbox}%
	\pgfmathparse{#1/\wd\measure@tikzpicture}%
	\edef\tikzscale{\pgfmathresult}%
	\BODY
}

\newsavebox\myboxA
\newsavebox\myboxB
\newlength\mylenA

\newcommand*\xoverline[2][0.75]{%
	\sbox{\myboxA}{$\m@th#2$}%
	\setbox\myboxB\null% Phantom box
	\ht\myboxB=\ht\myboxA%
	\dp\myboxB=\dp\myboxA%
	\wd\myboxB=#1\wd\myboxA% Scale phantom
	\sbox\myboxB{$\m@th\overline{\copy\myboxB}$}%  Overlined phantom
	\setlength\mylenA{\the\wd\myboxA}%   calc width diff
	\addtolength\mylenA{-\the\wd\myboxB}%
	\ifdim\wd\myboxB<\wd\myboxA%
	\rlap{\hskip 0.5\mylenA\usebox\myboxB}{\usebox\myboxA}%
	\else
	\hskip -0.5\mylenA\rlap{\usebox\myboxA}{\hskip 0.5\mylenA\usebox\myboxB}%
	\fi}

\setbeamertemplate{title page}{
  \vbox{}
  \vfill
  \begingroup
    \centering
    \begin{beamercolorbox}[sep=8pt,center]{title}
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%     
    \end{beamercolorbox}%
    \vskip1em\par
    \begin{beamercolorbox}[sep=0cm,wd=\the\@tempdima]{frametitle}
       \begin{tikzpicture}
        \draw[line width = 1.5] (-2,0) -- (12,0);
       \end{tikzpicture}
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,right]{author}
      \usebeamerfont{author}{Presentata da: \insertauthor}
    \end{beamercolorbox}
    \vskip1em
    \begin{beamercolorbox}[sep=8pt,left]{author}
      \usebeamerfont{author}{Relatore: \professor}
    \end{beamercolorbox}
    {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
    \begin{beamercolorbox}[sep=8pt,left]{institute}
      \usebeamerfont{institute}{\insertinstitute},
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}
  \endgroup
  \vfill
}

\newcommand*{\currentsectionname}{\@currentlabelname}

\makeatother

% -------------------------- code highlighting 
\usepackage[outputdir=intermediate]{minted}

% ------------------------- colors and other stuff for figures
% EM wavw
\colorlet{myblue}{black!40!blue}
\colorlet{myred}{black!40!red}
\colorlet{vcol}{green!50!black}
\colorlet{Ecol}{orange!90!black}
\colorlet{EVcol}{orange!80!black!60}
\colorlet{Bcol}{violet!90}

% EM spectrum
\colorlet{wavecol}{orange!35!black}
\colorlet{freqcol}{green!25!black}
\colorlet{enercol}{blue!35!black}
\pgfdeclareverticalshading{rainbow}{100bp}{
	color(0bp)=(red); color(25bp)=(red); color(35bp)=(yellow);
	color(45bp)=(green); color(55bp)=(cyan); color(65bp)=(blue);
	color(75bp)=(violet); color(100bp)=(violet)
}

% ------------------- units of measurements consistent style
\sisetup{
	detect-all,
	inter-unit-product=\ensuremath{{}\cdot{}},
  	separate-uncertainty=true,
  	uncertainty-separator={\,},
  	range-units=single,
  	per-mode=symbol,
  	exponent-product=\cdot,
  	output-decimal-marker={,},
}

% ----------------------------------- symbol definitions
% imaginary unit
\newcommand{\iu}{{i\mkern1mu}}

% ---------------- glossaries
\usepackage[toc]{glossaries}

% -------------------------- better management of larger projects
\usepackage{import}

% ----------------- stuff for customized title page
% \usepackage{titlesec}

% -------------------------- tables
\usepackage{tabularx} % equal spacing
\usepackage{tabulary} % spacing proportional to content
\usepackage{xltabular} % multipage tabularx
\usepackage{multirow}

% left-justified text in tables, and allow newlines
\newcolumntype{Y}{>{\raggedright\arraybackslash}X}
\newcolumntype{U}{>{\raggedright\arraybackslash}c}

% bibliography declaration
\addbibresource{references.bib}

% default font times new roman
\renewcommand{\familydefault}{\rmdefault}

% definition environment
\newtheoremstyle{theoremdd}% name of the style to be used
	{\topsep}% measure of space to leave above the theorem. E.g.: 3pt
  	{\topsep}% measure of space to leave below the theorem. E.g.: 3pt
  	{}% name of font to use in the body of the theorem
  	{0pt}% measure of space to indent
  	{\bfseries}% name of head font
  	{. ---}% punctuation between head and body
  	{ }% space after theorem head; " " = normal interword space
  	{\thmname{#1}\thmnumber{ #2}\textnormal{\thmnote{ (#3)}}}
\theoremstyle{theoremdd}
\newtheorem{definitionS}{Def.}[section] % numbered by section
\newtheorem{theoremS}{Th.}[section] % numbered by section

% shortcut to typeset code
\newcommand{\code}[1]{{\fontsize{10pt}{12pt}\fontfamily{qcr}\selectfont{#1}}}
\newfontfamily\codefont{DejaVu Sans}
\newcommand\tab[1][1cm]{\hspace*{#1}}
\newcommand{\littext}[1]{{\color{Rhodamine}{#1}}}
\newcommand{\hemi}[1]{\ensuremath{\mathfrak{H}^2(#1)}}
%\newcommand{\vector}[1]{\ensuremath{\mathbf{\overrightarrow{#1}}}}
\newcommand{\sha}{\ensuremath{\text{Ñˆ}}}

\newenvironment{altDescription}[1]
	{\begin{list}{}%
		{\renewcommand\makelabel[1]{\textsf{##1:}\hfil}%
			\settowidth\labelwidth{\makelabel{#1}}%
			\setlength\leftmargin{\labelwidth+\labelsep}}}
	{\end{list}}

\setmainfont{CharisSIL}
[
	Extension=.ttf,
	UprightFont=*-Regular,
	ItalicFont=*-Italic,
	BoldFont=*-Bold,
	BoldItalicFont=*-BoldItalic,
	Path=/usr/share/fonts/TTF/
]
\setmathfont{Latin Modern Math}
\setmathfont{XITSMath-Regular}
[
	Extension = .otf,
	BoldFont = XITSMath-Bold,
	Path=/usr/share/fonts/OTF/,
	range={"03F6,"0410-"044F}
]


\colorlet{myblue}{blue!80!black!70!red!70}
\colorlet{glasscol}{blue!10}
\tikzstyle{glass}=[top color=glasscol!88!black,bottom color=glasscol,middle color=glasscol!98!black,shading angle=0]
\tikzset{
	light beam/.style={
		line width=0.5, 
		arrows={-Stealth[length=2pt, inset=0.5pt, angle=70:4pt]},
		draw=#1,
	},
	light beam/.default=myblue}
\newcommand\rightAngle[4]{
	\pgfmathanglebetweenpoints{\pgfpointanchor{#2}{center}}{\pgfpointanchor{#3}{center}}
	\coordinate (tmpRA) at ($(#2)+(\pgfmathresult+45:#4)$);
	\draw[white,line width=0.6] ($(#2)!(tmpRA)!(#1)$) -- (tmpRA) -- ($(#2)!(tmpRA)!(#3)$);
	\draw[blue!40!black] ($(#2)!(tmpRA)!(#1)$) -- (tmpRA) -- ($(#2)!(tmpRA)!(#3)$);
}

% higher page numbers
\defbeamertemplate{footline}{higher page number}
{%
	\hskip10pt%\vspace{-10pt}
	\includegraphics[width=0.07\linewidth]{./assets/Poliba_stemma.png}
	\hfill%
	\usebeamercolor[fg]{page number in head/foot}%
	\usebeamerfont{page number in head/foot}%
	\insertframenumber\,/\,\inserttotalframenumber\kern1em\vskip10pt%
}
\setbeamertemplate{footline}[higher page number]

\title{Metodi di Monte Carlo Applicati Alla Computer Grafica}
\author{Tanzi Alessio}
\date{Anno Accademico 2022/2023}
\institute[]{Politecnico di Bari}

%\setbeamercovered{transparent} % permette di vedere il contenuto delle prossime slides del frame

\pgfkeys{/tikz/.cd,
	at/.initial={(0,0)},
	at/.get=\coordpos,
	at/.store in=\coordpos,   
	hemi/.code={
		% frame coordinates
		\coordinate (O) at (0,0); % origin
		\coordinate (R) at (2,0); % point to the right
		\coordinate (N) at (0,2); % top of the sphere
		\coordinate (U) at (R);
		\coordinate (V) at (canvas polar cs:angle=240,radius=0.67cm);

		% light rays coordinate
		\def\ang{30}
		\def\projang{15}
		\def\projdist{0.2cm}
		\def\ray{1.7cm}
		\coordinate (I) at (canvas polar cs:angle=90+\ang+\projang, radius=\ray); % view direction
		\coordinate (OR) at (canvas polar cs:angle=90-\ang, radius=\ray-\projdist); % reflected direction

		% angles 
		\draw pic["",draw=black,angle radius=20,angle eccentricity=1.3] {angle = N--O--I} node [anchor=north, above=23, left=0.05] {$\theta_i$};

		% frame arrows
		\draw[light beam=black] (O) -- (V) node [anchor=north east, above left=0.2] {$\hat{v}$};
		\draw[light beam=black] (O) -- (N) node [anchor=east, below left=0.2] {$\hat{n}$};
		\draw[light beam=black] (O) -- (R) node [anchor=north, above left=0.3] {$\hat{u}$};

		% light arrows
		\draw[light beam] (O) -- (I) node [anchor=north west, below=0.1] {$\hat{\omega}_i$};

		% point p
		\draw[black,fill=white] (O) circle [radius=0.05] node [below right=0.07] {$\vec{p}$};

		% the ball
		\shade[ball color=blue!70!gray!20, opacity=.15] 
			(R) arc (0:180:2cm) arc (180:360:2cm and 0.6cm);
			
		% outline of the hemisphere in black
		\draw (R) arc (0:180:2cm) arc (180:360:2cm and 0.6cm); 
		\draw [dashed] (R) arc (0:180:2cm and 0.6cm);
	}
}

\newcommand{\showslide}[3]{
\only<#1>{
	\begin{figure}[tb]
		\begin{subfigure}[c]{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{../assets/appendixD_result_#2.png}
		\caption{#2 campioni per stratum}
		\end{subfigure}
		\hfill
		\begin{subfigure}[c]{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{../assets/appendixD_result_#3.png}
		\caption{#3 campioni per stratum}
		\end{subfigure}
	\end{figure}
}}
\begin{document}

	\begin{frame}
		\maketitle
	\end{frame}

	\begin{frame}{Introduzione}
		\begin{columns}
			\begin{column}{0.35\textwidth}
				\includegraphics[width=\linewidth]{../assets/intro_path_tracing_online_tech_tips.png}
				\small Stima della funzione immagine $r_f(x,y)$ attraverso Path Tracing.
			\end{column}
			\begin{column}{0.65\textwidth}
				\only<1-3>{
					\begin{itemize}[topsep=0pt,noitemsep]
						\item[\bullet]<1-> Introduzione a bullets
						\item[\bullet]<2-> ancora da fare
						\item[\bullet]<3-> quando mi viene in mente
					\end{itemize}
					\hbox{\hfill}
					\only<1>{\begin{equation*}
						r_f(x,y)=\int_{A_{px}}r(x^\prime,y^\prime)\mathrm{d}A
					\end{equation*} }
					\only<2>{\begin{equation*}
						r_f(x,y)=\int_{A_{px}}f(x-x^\prime,y-y^\prime)r(x^\prime,y^\prime)\mathrm{d}A
					\end{equation*} }
					\only<3>{\begin{equation*}
						r_f(x,y)\approx\frac{\norm{A_{px}}}{n}\sum_{i=1}^{n}f(x-x_i,y-y_i)r(x_i,y_i)
					\end{equation*} }
				}
				\only<4>{
					\scriptsize
					\begin{tabularx}{\linewidth}{X}
					\toprule
					\textbf{Path Tracing}\label{pathTracing} \\
					\midrule
					\begin{algorithmic}
						\Inputt scena $\sigma$, risoluzione richiesta $(w,h)$, camera $c$
						\Outputt funzione immagine filtrata $r_f(x,y)$
						\State $r_f$ \gets Array($w$,$h$);
						\For{\textbf{each} pixel $(x,y)$ \textbf{in} $r_f$}
							\State ss \gets GenerateSamplesWithinPixel(x,y);
							\For{\textbf{each} sample ($\vec{s}$) \textbf{in} ss.positions}
								\State $\rho$ \gets CastRay$\left(c.\vec{p},\tfrac{\vec{s}-c.\vec{p}}{\norm{\vec{s}-c.\vec{p}}}\right)$;
								\State ss.contributions($\vec{s}$)\gets SampleRadiance($\sigma$,$\rho$, depth$=0$);
							\EndFor
							\State $r_f(x,y)$\gets Aggregate(ss.contributions);
						\EndFor
					\end{algorithmic}\\
					\bottomrule
					\end{tabularx}
				}
			\end{column}
		\end{columns}
	\end{frame}

	\begin{frame}{Indice}
		\tableofcontents[hideallsubsections]
	\end{frame}

	\AtBeginSection[ ]
	{
	\begin{frame}{Indice: \currentsectionname}
		\tableofcontents[currentsection,hideallsubsections]
	\end{frame}
	}

	\section{Monte Carlo Integration}
	\begin{frame}{Preliminari}
		\only<1>{
			\begin{altDescription}{probDefs}
				\item[Probabilit\`a $\Pr(A)$] Funzione definita su un dominio $\Sigma$ avente immagine $[0,1]$.
				\item[Variabile Casuale $X$] Formalizzazione matematica di quantit\`a numerica dipendente da eventi aleatori.
			\end{altDescription}
			\hbox{\hfill}
			Caratterizzata univocamente da
			\begin{altDescription}{PDF-CDF}
				\item[CDF] %Funzione associante ad una variabile casuale $X$ la probabilit\`a di restituire un'osservazione $\leq$ ad un campione $X$
					$\displaystyle P(x)=\Pr(X\leq x)$
				\item[PDF] %Funzione associante ad una variabile casuale $X$ la "probabilit\`a per unit\`a di lunghezza" associata ad un campione $x$.
					%Intuitivamente, probabilit\`a per $X\in[x,x+\mathrm{d}x]$
					$\displaystyle p(x)=\frac{\mathrm{d}}{\mathrm{d}x}P(x)$
			\end{altDescription}
		}
		\only<2>{
			\begin{altDescription}{d}
				\item[Stimatore $\tilde{F}_n$] funzione di una collezioni di variabili aleatorie $X_i$, $n$ campioni, mappati ad una 
					stima di uno stimando $F$
			\end{altDescription}
			\begin{align*}
			\begin{array}{lrl}
				\mathsf{Aspettazione: }& E[f(X)]&=\displaystyle\int_{\mathcal{D}}f(x)p(x)\mathrm{d}x \\
				\mathsf{Varianza: }& V[f(X)]&=E\left[(f(X)-E[f(X)])^2\right] \\
				\mathsf{Bias: }& \beta&=E[\tilde{F}_n(X_1,\ldots,X_n)]-F \\
				\mathsf{Efficienza: }& \epsilon[\tilde{F}_n]&=\displaystyle\frac{1}{T[\tilde{F}_n]V[\tilde{F}_n]} \\
				\mathsf{MSE: }& MSE[\tilde{F}_n]&=E\left[(\tilde{F}_n-F)^2\right]=V[\tilde{F}_n]+\beta^2
			\end{array}
			\end{align*}
		}
	\end{frame}
	\begin{frame}{Integrazione di Monte Carlo}
		\only<1-2>{Stimatore Unbiased per l'Integrazione Monte Carlo}
		\only<1>{\begin{equation*}
			\tilde{F}_n=\norm{\mathcal{D}}\tilde{E}_n[f(X)]=\frac{1}{n}\sum_{i=1}^n\frac{f(X_i)}{p(x)}
		\end{equation*}
			Il campionamento secondo PDF $p(x)$ permette di scegliere accuratamente i campioni pi\`u significativi (\textit{Importance Sampling})
		}
		\only<2->{\begin{equation*}
			\tilde{F}_n=\norm{\mathcal{D}}\tilde{E}_n[f(X)]=\frac{\norm{\mathcal{D}}}{n}\sum_{i=1}^nf(X_i)
		\end{equation*}}
		\only<2>{(Campionamento $\mathcal{U}(\mathcal{D})$)}
		\only<3>{
			Per $n$ campioni, la deviazione standard diminuisce di $\sqrt{n}$
			\begin{equation*}
				\sigma[\tilde{F}_n]=
					\sqrt{V[\tilde{F}_n]}=\sqrt{\frac{\norm{\mathcal{D}}^2}{n}V[f(X)]}=\frac{\norm{\mathcal{D}}}{n^{\frac{1}{2}}}\sigma[f(X)]
			\end{equation*}
		}
	\end{frame}

	\begin{frame}{Esempio: Integrale monodimensionale}
		\begin{columns}
			\begin{column}{0.35\textwidth}
				\begin{scaletikzpicturetowidth}{\linewidth}\begin{tikzpicture}[scale=\tikzscale]
					\begin{axis} [
						axis lines = left,
						ymin=0, ymax=4,
						xmin=0, xmax=11,
						declare function={
							s(\x)=sqrt(((pi^2)/10)*\x);
							func(\x)=sin(s(\x)*180/pi)*e^s(\x)/s(\x);
						},
					]
						\addplot[color=black, domain=0.001:11, domain y=0:4, samples=50,]{func(x)};
					\end{axis}
				\end{tikzpicture}\end{scaletikzpicturetowidth}
				{\small\begin{equation*}
					f(x)=\frac{\sin\left(\sqrt{\frac{\pi^{2}}{10}x}\right)}{\sqrt{\frac{\pi^{2}}{10}x}}e^{\sqrt{\frac{\pi^{2}}{10}x}}
				\end{equation*}}
			\end{column}
			\begin{column}{0.65\textwidth}
				dslhflskajfkladsfdsajfldsjflkdsj
				dslhflskajfkladsfdsajfldsjflkdsj
				dslhflskajfkladsfdsajfldsjflkdsj
				dslhflskajfkladsfdsajfldsjflkdsj
			\end{column}
		\end{columns}
	\end{frame}
	
	\section{Rendering Fundamentals}

	\begin{frame}{Rendering Equation}
		\begin{figure}[tb]
			\fontsize{8pt}{9.6pt}
			\centering
			\begin{subfigure}[b]{0.3\textwidth}
				\begin{scaletikzpicturetowidth}{\linewidth}\begin{tikzpicture}[scale=\tikzscale]
					\def\ang{30}
					\def\projang{15}
					\def\projdist{0.2cm}
					\def\ray{1.7cm}
					\coordinate (O) at (0,0); % origin
					\coordinate (OR) at (canvas polar cs:angle=90-\ang, radius=\ray-\projdist); % reflected direction
					\node[at={(0,0)}, hemi]{};
					\draw[light beam] (O) -- (OR) node [anchor=north, right=0.1] {$\hat{\omega}_r$};
					\draw pic["",draw=black,angle radius=20,angle eccentricity=1.3]{angle = OR--O--N}node[anchor=north,above=23,right=0.05]{$\theta_r$};
				\end{tikzpicture}\end{scaletikzpicturetowidth}
				\caption{Specular BRDF}
			\end{subfigure}\hspace*{\fill}
			\begin{subfigure}[b]{0.3\textwidth}
				\begin{scaletikzpicturetowidth}{\linewidth}\begin{tikzpicture}[scale=\tikzscale]
					\coordinate (O) at (0,0);
					\node[at={(O)}, hemi]{};

					\begin{scope}[scale=0.4, every node/.style={scale=0.4}, rotate=-40]
						\def\r{1} % r is the radius of the cone base
						\def\R{1.042*\r}   % R is the radius of the sphere
						\pgfmathsetmacro\h{sqrt(\R*\R-\r*\r)} 
						\pgfmathsetmacro\a{asin(\r/\R)}
						\pgfmathsetmacro\H{\r*tan(\a)}
						
						\coordinate (Apex) at (0,0);
						\coordinate (BaseLeft) at ($(Apex) + (-\r,\H)$);%(-\r,0);
						\coordinate (SphereCenter) at ($(Apex) + (0,\h+\H)$);
						\coordinate (BaseRight) at ($(Apex) + (\r,\H)$);%(\r,0);
						
						% Wireframe
						\draw[fill=myblue!70] (BaseRight) arc (-90+\a:270-\a:\R);
						\draw[fill=myblue!70] (BaseLeft) -- (Apex) -- (BaseRight);
						\draw[fill=myblue!70] (BaseRight) arc (0:-180:\r cm and 0.2*\r cm);
						\draw[dashed, fill=myblue!70] (BaseRight) arc (0:180:\r cm and 0.2*\r cm);
					\end{scope}

				\end{tikzpicture}\end{scaletikzpicturetowidth}
				\caption{Glossy BRDF}
			\end{subfigure}\hspace*{\fill}
			\begin{subfigure}[b]{0.3\textwidth}
				\begin{scaletikzpicturetowidth}{\linewidth}\begin{tikzpicture}[scale=\tikzscale]
					\coordinate (R) at (2,0); % point to the right
					\node[at={(0,0)}, hemi]{};

					% diffuse reflection ball
					\shade[ball color=myblue, opacity=.5] 
						($(R) - (1,0)$) arc (0:180:1cm) arc (180:360:1cm and 0.3cm);
						
					% outline of the reflection hemisphere
					\draw ($(R) - (1,0)$) arc (0:180:1cm) arc (180:360:1cm and 0.3cm); 
					\draw [dashed] ($(R) - (1,0)$) arc (0:180:1cm and 0.3cm);
				\end{tikzpicture}\end{scaletikzpicturetowidth}
				\caption{Diffuse BRDF}
			\end{subfigure}
		\end{figure}

		\begin{equation*}\label{chapter3:surface:renderingEq}
			L_o(\vec{p},\hat{\omega}_o) = L_e(\vec{p},\hat{\omega}_o) + \int_{\mathcal{S}^2}%
				L_o(t(\vec{p}, \hat{\omega}_i),-\hat{\omega}_i)f_s(\vec{p},\hat{\omega}_o,\hat{\omega}_i)%
				\vert\langle\hat{n},\hat{\omega}_i\rangle\vert\mathrm{d}\hat{\omega}_i
		\end{equation*}
	\end{frame}

	\section{Campionamento e Ricostruzione}

	\section{Path Tracing}

	\begin{frame}{Risultati Simulazione}
		\showslide{1}{8}{40}
		\showslide{3}{200}{1000}
		\showslide{5}{5k}{25k}
		\only<2>{
			\begin{table}[tb]
				\small
				\begin{tabularx}{\linewidth}{XXX}
					\toprule
					\multirow{2}{*}{Componente analizzata} & \multicolumn{2}{>{\hsize=\dimexpr2\hsize- + 2\tabcolsep\relax}c}{Varianza trovata} \\
					& 8 campioni per stratum & 40 campioni per stratum \\
					\midrule
					Red Channel					& 0.07344142 & 0.05132978 \\
					Green Channel				& 0.06190188 & 0.04714374 \\
					Blue Channel				& 0.07339846 & 0.05175589 \\
					Luminance\footnotemark{}	& 0.06380390 & 0.04621717 \\
					\bottomrule
				\end{tabularx}
				\caption{Tabella delle varianze per la resa con 8 campioni per stratum e 40 campioni per stratum}
			\end{table}
			\footnotetext{Pi\`u precisamente, Luma channel del color space ITU-R BT.709}
		}
		\only<4>{
			\begin{table}[tb]
				\small
				\begin{tabularx}{\linewidth}{XXX}
					\toprule
					\multirow{2}{*}{Componente analizzata} & \multicolumn{2}{>{\hsize=\dimexpr2\hsize- + 2\tabcolsep\relax}c}{Varianza trovata} \\
					& 200 campioni per stratum & 1000 campioni per stratum \\
					\midrule
					Red Channel					& 0.02482136 & 0.02023584 \\
					Green Channel				& 0.02453323 & 0.02019825 \\
					Blue Channel				& 0.02517796 & 0.02031221 \\
					Luminance					& 0.02276842 & 0.01840096 \\
					\bottomrule
				\end{tabularx}
				\caption{Tabella delle varianze per la resa con 200 campioni per stratum e 1000 campioni per stratum}
			\end{table}
		}
		\only<6>{
			\begin{table}[tb]
				\small
				\begin{tabularx}{\linewidth}{XXX}
					\toprule
					\multirow{2}{*}{Componente analizzata} & \multicolumn{2}{>{\hsize=\dimexpr2\hsize- + 2\tabcolsep\relax}c}{Varianza trovata} \\
					& 5000 campioni per stratum & 25000 campioni per stratum \\
					\midrule
					Red Channel					& 0.01904086 & 0.01885027 \\
					Green Channel				& 0.01936775 & 0.01919554 \\
					Blue Channel				& 0.01930308 & 0.01911878 \\
					Luminance					& 0.01754279 & 0.01737635 \\
					\bottomrule
				\end{tabularx}
				\caption{Tabella delle varianze per la resa con 5000 campioni per stratum e 25000 campioni per stratum}
			\end{table}
		}
	\end{frame}

\end{document}
